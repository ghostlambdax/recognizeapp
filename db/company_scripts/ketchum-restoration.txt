recognitions: paranoid (723)
  recognition_recipient: paranoid
  recognition_tags: not paranoid (FIXME)
  point_activities: not paranoid
  recognition_approvals: paranoid
recognition_recipient: paranoid
point_activities: not paranoid (but maybe we can regenerate based on recognitions) (3490)
  point_activity_teams: not paranoid (7521)
completed_tasks: not paranoid
  point_activities: not paranoid
task_submissions: not paranoid (2)
  completed_tasks: not paranoid
nomination_votes: not paranoid (0)
nomination: not paranoid (0)
  nomination_votes: not paranoid
redemption: paranoid (1 - but denied)
  point_activities: not paranoid


Plan: 

start_time = Time.parse("December 2nd, 2020 14:23 EST")
end_time = Time.parse("December 2nd, 2020 14:50 EST")
company = Company.where(domain: "ketchum.com").first
recognitions_to_flip = company.recognitions.with_deleted.where(deleted_at: start_time..end_time)
recognition_ids = recognitions_to_flip.map(&:id)
recognitions_to_flip.update_all(deleted_at: nil)

recognition_recipients_to_flip = RecognitionRecipient.with_deleted.where(recognition_id: recognition_ids)
recognition_recipients_to_flip.update_all(deleted_at: nil)
recognition_approvals_to_flip = RecognitionApproval.with_deleted.where(recognition_id: recognition_ids).update_all(deleted_at: nil)

failures = []
recognitions_to_flip.each do |r| 
  Timecop.freeze(r.created_at)
  begin
    PointActivity::Recorder.record!(r) 
  rescue => e
    failures << [r, e]
  end
  Timecop.return
end
PointActivity.where(company_id: company.id).update_all(amount: 0)
company.users.map{|u| u.update_all_points! }

# Tests
# Test correct number of recognitions: 727
# Test approvals and comments show on recognitions


Logs:
12/2/2020 10:57PM - Beginning script
recognition_ids: [7] pry(main)> recognition_ids.join(",")
=> "788132,788122,788121,788058,786557,786077,786035,785837,785342,785341,785037,784635,784497,784401,784071,784057,784048,784042,783998,783991,783983,783789,783524,783506,783505,783504,783503,783502,783370,783036,783035,783034,783033,782804,782803,782277,782265,782264,782263,782262,782261,781809,781577,781576,781513,781378,781369,781355,781247,781087,781056,780931,780626,780619,780586,780559,780558,780557,780481,780280,780270,780269,780268,780242,780100,780015,780013,780008,780000,779975,779970,779889,779863,779679,779658,779647,779638,779495,779493,779461,779460,779459,779354,779308,778999,778996,778994,778986,778935,778918,778819,778695,778694,778693,778692,778330,778329,778328,778091,777975,777958,777887,777884,777882,777639,777519,777380,777372,777371,777366,777336,777181,777112,776980,776978,776921,776911,776873,776843,776841,776838,776836,776834,776068,776067,776066,775760,775723,775719,775644,775637,775595,774864,774856,774811,774799,774566,774494,774493,774492,774244,774243,774225,774180,774161,774158,774133,774130,773982,773991,773946,773936,773849,773847,773817,773806,773734,773667,773559,773558,773557,773556,773122,773105,772994,772977,772939,772803,772798,772795,772786,772785,772473,772344,772343,772064,772063,771876,771768,771578,771468,771383,771380,771320,771225,770837,770789,770787,770774,770739,770734,770634,770627,770596,770536,770346,770239,770238,770237,770236,770235,769980,769972,769940,769845,769829,769824,769820,769815,769812,769807,769680,769648,769625,769601,769595,769588,769375,769358,769357,769356,769201,769200,769188,769187,769186,769123,769041,768676,768612,768607,768606,768425,768393,768379,768345,768317,768293,768174,768110,767852,767851,767850,767849,767525,767524,767523,767522,767521,767314,767313,767312,767185,767174,767169,767154,766913,766863,766782,766772,766751,766735,766678,766478,766432,766431,766118,765917,765766,765751,765749,765747,765677,765597,765490,765454,765448,765414,765400,765399,765398,765317,765303,765022,764956,764885,764444,763923,763760,763545,763428,763427,763265,763177,763145,763075,762377,762326,762290,762259,762191,762109,762079,762076,762053,761885,761881,761872,761814,761813,761740,761739,761738,761737,761394,761393,761392,760872,760729,760695,760533,760437,759999,759926,759908,759649,759647,759636,759635,759474,759464,759450,759398,759397,759392,759391,759347,759219,759212,759196,759027,758931,758759,758757,758756,758600,758580,758535,758164,757975,757951,757950,757849,757737,757721,757719,757670,757606,757121,757071,756864,756834,756703,756529,756527,756512,756508,756382,756319,756140,756010,755870,755739,755738,755737,755736,755507,755506,755336,755304,755302,755229,755217,755144,755091,754607,754606,754605,754604,754319,754144,753752,753625,753575,753574,753573,753572,753357,753195,753176,753174,753152,753151,753098,753091,753076,753032,752982,752977,752975,752940,752920,752912,752901,752874,752863,752821,752784,752783,752775,752772,752769,752697,752648,752593,752592,752447,752444,752373,752371,752364,752306,752296,752067,752055,751717,751512,751511,751510,751509,751508,751117,751079,750849,750750,750731,750420,750419,750418,750417,750416,750415,750342,750167,750137,750033,749928,749807,749805,749778,749755,749744,749743,749739,749738,749721,749715,749692,749685,749683,749672,749670,749668,749613,749566,749543,749485,749420,749407,749318,749309,749308,749295,749287,749284,749282,749279,749261,749255,749247,749096,749095,749094,749017,748192,748138,748134,748127,748121,748082,748075,747929,747928,747927,747926,747925,747923,747852,747791,747663,747661,747621,747533,747530,747525,747523,747494,747472,747384,747369,747364,747357,747241,747240,747239,747134,747065,747006,746957,746932,746924,746781,746775,746726,746700,746572,746553,746552,746551,746550,746498,746470,746430,746335,746317,746245,745895,745893,745892,745890,745681,745680,745679,745678,745549,745483,745482,745380,745374,745373,745358,745341,745340,745338,745337,745318,745187,745176,745164,745122,745059,745039,744990,744910,744827,744731,744730,744729,744728,744652,744644,744643,744642,744639,744635,744624,744622,744603,744590,744559,744524,744479,744470,744467,744434,744413,744409,744352,744278,744259,744258,744256,744253,744248,744244,744233,744204,744187,744169,744167,744125,744115,744112,744107,744092,744076,744072,744036,744032,743980,743912,743904,743902,743825,743782,743778,743776,743770,743768,743767,743762,743761,743731,743695,743694,743693,743692,743691,743690,743689,743687,743686,743685,743644,743624,743621,743607,743604,743601,743598,743587,743559,743555,743543,743541,743537,743529,743527,743525,743521,743517,743495,743475,743456,743445,743436,743433,743432,743427,743424,743422,743419,743417,743414,743411,743409,743399,743398,743372,743370,743368,743352,743340,743331,743329,743322,743319,743317,743316,743312,743304,743293,743297,743284,743278,743277,743275,743274,743272,743268,743266,743191,743187,741637,737660,737656,737539,736014,736007,735760,732614,732553,732551,724761,723666,722437,722436,722434,722003,721816,721640,721341,720182,715777,714971,714965,700330"
[8] pry(main)> recognition_ids.length
=> 727


[11] pry(main)> recognition_recipients_to_flip.map(&:id).join(",")                                                            [38/328]
=> "1151469,1174798,1174807,1176058,1181726,1183444,1183923,1184332,1184608,1185193,1185244,1185245,1186929,1188543,1201446,1201448,12
01522,1206904,1207361,1207369,1209518,1209672,1209676,1217040,1219757,1219758,1219759,1219760,1219761,1219762,1219763,1219769,1219896,
1219898,1219902,1219904,1219905,1219908,1219909,1219917,1219933,1219938,1219957,1219967,1219971,1219972,1219974,1219977,1219978,121997
9,1219980,1219981,1219982,1219983,1219984,1219985,1219993,1219999,1220016,1220030,1220050,1220052,1220054,1220080,1220081,1220101,1220
103,1220108,1220111,1220119,1220122,1220124,1220125,1220126,1220127,1220128,1220129,1220130,1220131,1220132,1220133,1220134,1220135,12
20136,1220137,1220138,1220139,1220140,1220141,1220142,1220143,1220144,1220145,1220146,1220152,1220153,1220154,1220155,1220156,1220157,
1220158,1220159,1220160,1220161,1220162,1220163,1220164,1220165,1220166,1220167,1220168,1220174,1220175,1220176,1220177,1220178,122018
2,1220200,1220201,1220202,1220203,1220204,1220205,1220217,1220218,1220248,1220249,1220250,1220251,1220252,1220253,1220276,1220304,1220
309,1220310,1220314,1220316,1220318,1220330,1220342,1220344,1220357,1220365,1220366,1220367,1220407,1220408,1220409,1220410,1220411,12
20412,1220447,1220452,1220456,1220459,1220474,1220477,1220499,1220554,1220555,1220556,1220558,1220559,1220560,1220561,1220562,1220563,
1220564,1220565,1220566,1220628,1220674,1220675,1220683,1220684,1220685,1220689,1220690,1220691,1220692,1220693,1220694,1220695,122072
8,1220730,1220731,1220735,1220802,1220887,1220889,1220898,1221020,1221021,1221022,1221078,1221082,1221130,1221131,1221132,1221136,1221
162,1221184,1221189,1221194,1221207,1221264,1221266,1221267,1221296,1221323,1221324,1221325,1221326,1221360,1221361,1221362,1221363,12
21364,1221365,1221366,1221367,1221368,1221392,1221396,1221402,1221405,1221406,1221408,1221409,1221430,1221522,1221601,1221602,1221603,
1221604,1221605,1221606,1221607,1221608,1221616,1221651,1221695,1221707,1221729,1221814,1221855,1221918,1221919,1221920,1221921,122192
2,1221923,1221924,1221925,1221942,1221964,1221970,1221989,1221990,1221991,1221992,1221993,1221994,1221995,1222000,1222003,1222004,1222
005,1222006,1222007,1222008,1222009,1222010,1222011,1222031,1222126,1222127,1222128,1222129,1222347,1222460,1222611,1222681,1222724,12
22810,1222867,1222882,1222883,1222884,1222885,1222886,1222898,1223254,1223255,1223256,1223257,1223287,1223288,1223291,1223292,1223310,
1223340,1223341,1223347,1223455,1223456,1223522,1223523,1223524,1223525,1223734,1223735,1223736,1223737,1224048,1224049,1224050,122405
2,1224053,1224055,1224537,1224690,1224724,1224725,1224726,1224727,1224847,1224892,1224933,1224934,1224935,1224936,1224937,1224938,1224
990,1224991,1224992,1224993,1225024,1225222,1225258,1225316,1225331,1225518,1225526,1225555,1225624,1225709,1225710,1225711,1225712,12
25713,1225714,1225715,1225716,1225815,1225936,1225937,1225938,1226092,1226100,1226105,1226128,1226129,1226130,1226292,1226327,1226359,
1226364,1226365,1226366,1226372,1226373,1226377,1226516,1226517,1226585,1226587,1226770,1226848,1226849,1226850,1226851,1226972,122698
1,1226982,1226983,1226984,1226985,1227182,1227196,1227252,1227258,1227274,1227278,1227390,1227391,1227392,1227393,1227394,1227395,1227
396,1228849,1228944,1228945,1228946,1229163,1229164,1229174,1229181,1229182,1229183,1229184,1229185,1229186,1229187,1229188,1229189,12
29190,1229191,1229192,1229216,1229217,1229218,1229219,1229220,1229221,1229222,1229223,1229224,1229225,1229226,1229227,1229228,1229229,
1229230,1229231,1229232,1229233,1229234,1229235,1229236,1229237,1229238,1229239,1229240,1229241,1229242,1229243,1229244,1229245,122924
6,1229247,1229248,1229249,1229250,1229251,1229252,1229253,1229254,1229255,1229256,1229257,1229260,1229264,1229267,1229294,1229310,1229
311,1229324,1229468,1229503,1229504,1229628,1229699,1229734,1229994,1230099,1230101,1230103,1230117,1230118,1230119,1230121,1230122,12
30123,1230130,1230191,1230199,1230236,1230237,1230242,1230243,1230244,1230255,1230286,1230313,1230315,1230484,1230612,1230719,1230753,
1230754,1230997,1230998,1230999,1231000,1231001,1231002,1231087,1231088,1231089,1231090,1231091,1231092,1231908,1231909,1231932,123222
5,1232756,1232818,1233498,1233499,1233500,1233501,1233502,1233811,1233812,1234397,1234413,1234814,1234825,1234895,1234910,1234912,1235
017,1235020,1235289,1235290,1235350,1235419,1235509,1235513,1235516,1235532,1235533,1235578,1235629,1235651,1235688,1235707,1235728,12
35751,1235809,1235811,1235817,1235895,1235946,1235975,1235982,1236060,1236061,1236095,1236097,1236121,1236373,1236718,1236719,1236720,
1236721,1236782,1236934,1237581,1237582,1237886,1238346,1238347,1238348,1238349,1239017,1239090,1239302,1239321,1239422,1239424,123948
2,1239483,1239484,1239485,1239486,1239772,1239773,1240016,1240017,1240018,1240019,1240160,1240329,1240491,1240729,1240815,1240987,1240
991,1241012,1241014,1241340,1241493,1241529,1241786,1241892,1242578,1242653,1242654,1242655,1242656,1242657,1242658,1242715,1242717,1242735,1242736,1242737,1242738,1242887,1242888,1242889,1242890,1242891,1242892,1242893,1242894,1242895,1242896,1242897,1242898,1242899,1242900,1242901,1242902,1242903,1242904,1242905,1242906,1242907,1242908,1242909,1242910,1242911,1242912,1242913,1242914,1242915,1242916,1242917,1242918,1242919,1242920,1242921,1242922,1242923,1242924,1242925,1242926,1242927,1242928,1242929,1242930,1242931,1242932,1242933,1242934,1242935,1242936,1242937,1242938,1242939,1242940,1242941,1242942,1242943,1242944,1242945,1242946,1242947,1242948,1242949,1242950,1242951,1242952,1242953,1242954,1242955,1242956,1242957,1242958,1242959,1242960,1242961,1242962,1242963,1242964,1242965,1242966,1242967,1242968,1242969,1242970,1242971,1242972,1242973,1242974,1242975,1242976,1242977,1242978,1242979,1242980,1242981,1242982,1242983,1242984,1242985,1242986,1242987,1242988,1242989,1242990,1242991,1242992,1242993,1242994,1242995,1242996,1242997,1242998,1242999,1243000,1243001,1243002,1243003,1243004,1243005,1243006,1243007,1243008,1243009,1243010,1243011,1243012,1243013,1243014,1243015,1243016,1243017,1243018,1243019,1243020,1243021,1243022,1243023,1243024,1243025,1243026,1243027,1243028,1243029,1243030,1243031,1243032,1243033,1243034,1243035,1243036,1243037,1243038,1243039,1243040,1243041,1243042,1243043,1243044,1243045,1243046,1243047,1243048,1243049,1243050,1243051,1243052,1243053,1243054,1243055,1243179,1243180,1243207,1243470,1244126,1244127,1244128,1244202,1244243,1244244,1244245,1244246,1244247,1244248,1244456,1244457,1244459,1244797,1244925,1245193,1245212,1245213,1245214,1245215,1245216,1245217,1245218,1245219,1245220,1245221,1245231,1245404,1245477,1245478,1245483,1245484,1245485,1245579,1245598,1245637,1245905,1245906,1245925,1245927,1245928,1246306,1246307,1246331,1246426,1246427,1246428,1246429,1246430,1247134,1247135,1247258,1247540,1247577,1247578,1247579,1247580,1247808,1248399,1248400,1248401,1248817,1248818,1248819,1248820,1249018,1249019,1249128,1249139,1249146,1249358,1249388,1249396,1249449,1249572,1249666,1249707,1249758,1249885,1251270,1251271,1251429,1251430,1251431,1251432,1251506,1251507,1251508,1251509,1251510,1251511,1251512,1251513,1251680,1252144,1252145,1252329,1252584,1252585,1252586,1252792,1253693,1254295,1254437,1254528,1254970,1254971,1254992,1255073,1255074,1255075,1255093,1255094,1255136,1255142,1255194,1255320,1255418,1255549,1255551,1255553,1255575,1255786,1256183,1256649,1256650,1256708,1257013,1257089,1257106,1257169,1257170,1257187,1257188,1257189,1257190,1257191,1257192,1257193,1257194,1257195,1257332,1257389,1257728,1257754,1257766,1257787,1257967,1257968,1257969,1258211,1258212,1258213,1258214,1258215,1258626,1258627,1258628,1258629,1259165,1259284,1259436,1259464,1259506,1259550,1259567,1259675,1259676,1259677,1259678,1259931,1259932,1259941,1260031,1260598,1260704,1260801,1260802,1260803,1260818,1260819,1261009,1261010,1261011,1261034,1261362,1261373,1261374,1261375,1261376,1261377,1261378,1261379,1261380,1261386,1261420,1261454,1261488,1261721,1261732,1261735,1261746,1261750,1261764,1261785,1261942,1262014,1262015,1262016,1262017,1262030,1262431,1262432,1262433,1262434,1262435,1262571,1262809,1262902,1262952,1262959,1262960,1262961,1262962,1262963,1262964,1262965,1262966,1262967,1262968,1262969,1262970,1263139,1263146,1263192,1263208,1263211,1263286,1263823,1263937,1264037,1264040,1264245,1264464,1264755,1264907,1265244,1265245,1265604,1265605,1265822,1266320,1266321,1266322,1266332,1266335,1266345,1266560,1266604,1266605,1266606,1266607,1266608,1266628,1266629,1266630,1266631,1266632,1266633,1266634,1266635,1266636,1266637,1266638,1266639,1266806,1266831,1267895,1267896,1267897,1267898,1268050,1268196,1268323,1268338,1268403,1268405,1268531,1268532,1268533,1268534,1268535,1268536,1268537,1268538,1268557,1268619,1268629,1268810,1268811,1268814,1268870,1268873,1268905,1268906,1268907,1268908,1268953,1268975,1268976,1269516,1269517,1269518,1269602,1269603,1269604,1269916,1269917,1269929,1269930,1269931,1269932,1269933,1270013,1270021,1271553,1271615,1271616,1271631,1271772,1271776,1271827,1272219,1272220,1272221,1273433,1273435,1273437,1273440,1273442,1273492,1273557,1273558,1273559,1273560,1273561,1273562,1273572,1273670,1273672,1273859,1273928,1274157,1274194,1274200,1274201,1274219,1274481,1274482,1274483,1274484,1274662,1275092,1275094,1275097,1275098,1275099,1275100,1275199,1275243,1275413,1275729,1275730,1275731,1276318,1276319,1276320,1276321,1276604,1276794,1276815,1276816,1276911,1276922,1276924,1276927,1277401,1277471,1277472,1277639,1277640,1277641,1277673,1277675,1277676,1277981,1277982,1278003,1278023,1278049,1278050,1278327,1278353,1278476,1278481,1278482,1278560,1278568,1278569,1278574,1278576,1278701,1278933,1278969,1278970,1278971,1278981,1279277,1279361,1279362,1279363,1279414,1279456,1279469,1279981,1280197,1280247,1280450,1280665,1280686,1280687,1280688,1280704,1280919,1281001,1281002,1281366,1282912,1282913,1282914,1282915,1282916,1282928,1282929,1283753,1283754,1284013,1284014,1284015,1284016,1284693,1284694,1284695,1284696,1284697,1284698,1284874,1284875,1284876,1284877,1284878,1284896,1285218,1285625,1285634,1285643,1285697,1285703,1285714,1285730,1286298,1286299,1286300,1286396,1286535,1287635,1288093,1288094,1288760,1289039,1289095,1289854,1292000,1292064,1292065,1292075"
[12] pry(main)> recognition_recipients_to_flip.length
=> 1282

[15] pry(main)> recognition_approvals_to_flip.map(&:id).length
=> 605

[16] pry(main)> recognition_approvals_to_flip.map(&:id).join(",")
=> "907457,919490,907460,918244,912425,918542,912680,913180,918541,918676,919513,918644,918152,918190,918242,918679,918183,918189,918240,918289,918326,918680,919127,918182,918325,918322,918478,918260,918288,918321,918580,918681,918682,918259,918287,918320,918286,918579,918683,918272,918276,918316,918422,918540,925582,918816,918315,918263,918283,918313,918285,918311,919524,918538,918271,918451,919523,918450,918477,918537,918449,918536,918684,918328,918476,918554,918475,918577,918686,918640,919522,922821,918535,919521,918654,919519,918641,919516,919111,919123,953255,918503,918567,918599,918642,918687,919178,923665,926064,918534,919517,918581,918689,918690,918574,918691,919132,919122,919121,918561,918569,918578,918643,918652,918653,918692,919120,919525,919117,925680,919116,919115,918602,918672,919131,918669,919157,918773,922681,918767,922325,919219,919228,918822,918824,918823,918825,919204,919147,919145,919156,919154,919177,919432,919203,921500,919212,919580,919351,919441,919512,919393,919491,919584,919554,920405,919625,919626,919631,919632,919838,919966,919973,921659,920219,921313,920392,920419,921312,920400,922820,920418,922780,920436,936171,921507,922364,923330,925681,922363,920835,920925,920924,922933,921506,922356,922298,922355,921735,922354,922353,931787,923587,922218,922352,922351,922350,922349,922863,922888,922311,935976,943877,948737,922313,922348,922854,926315,922627,922785,922853,922852,923137,922680,922782,922784,922851,922859,924688,922679,922835,922849,934239,922678,947806,922682,922848,922847,922858,922789,922826,922830,922871,923114,923293,923656,928778,947805,922845,922857,922903,923029,923051,923116,923189,923292,923311,923654,923586,925683,925685,923479,923530,923921,924009,928003,923514,923532,923642,923977,928002,923976,924026,925324,952119,924486,929003,924222,924482,924293,925689,924317,924381,924481,927999,924670,927446,925691,927998,924649,928080,927445,924669,924689,924800,929002,924799,928079,929001,924692,925508,924932,927952,928078,924715,924802,924973,927930,927951,934238,925506,925428,926533,929033,947931,947935,952118,927950,932503,952117,925692,927949,928242,933362,926073,926968,929000,932162,933361,926099,928077,926072,926098,926188,934237,947803,926962,927948,927142,927186,927410,927947,927409,927946,933359,927945,927444,927936,927469,927943,931651,927590,931652,931620,927932,927942,928750,927907,930930,934252,930929,934251,927820,927903,940311,927898,933357,934250,927894,928101,933356,934248,934249,947802,928372,943846,928960,943876,931786,929832,932486,931613,933355,934247,952960,934246,931982,932081,933354,934142,934245,932079,932160,939870,932387,933389,932391,933386,932483,933385,932430,934244,933874,934138,933423,939869,933758,934137,935980,936536,939868,934243,934135,934136,934262,934261,934242,934260,934241,934896,936525,943009,938350,934632,934845,934893,934691,934787,935276,935975,935275,935974,936522,936664,939867,943008,935973,943875,935972,936516,936510,936663,939866,936388,936512,936662,938809,939865,941977,943006,936660,936993,941975,936994,943005,943004,937543,939520,943003,940042,942825,943002,939005,939519,940041,947930,947934,940040,941312,943001,943845,947800,939038,939518,939006,940342,939517,943000,943873,939849,947801,939848,940341,942999,942998,943872,943869,940685,940684,942996,941963,941974,942989,941958,942038,942980,941949,941956,942979,944064,941948,941955,947796,942978,952959,942975,942973,943870,943561,943744,944182,944180,944181,944179,951537,944683,944838,945348,945347,945346,945344,945343,945261,945301,945466,953256,953257,946921,947790,952958,946425,946450,946465,947768,946920,946701,948635,952249,947103,947618,947508,947724,947765,947776,949679,947763,948351,947777,947837,947865,949596,949677,948433,949595,948522,949674,948523,953258,948820,952957,948819,952248,948818,949594,949671,949916,949928,952243,952254,952242,952241,951023,951547,952240,950947,951540,951928,951542,951927,952247,951916,952239,952796,951802,951801,951926,951962,952024,952377,952431,952747,952784,952956,952998,956016,952502,952954,952955,952788,952787,952789,952997,952953,952987,952990,952996,952985,953766,952988,952995,952986,952989,953680,953244,953611,954258,956384,954257,954256,956207,955403,956206,956257,956639,959808"

Completed 11:13PM
